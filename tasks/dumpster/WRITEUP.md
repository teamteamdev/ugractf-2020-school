# Сага о резервных копиях: Write-up

Дан дамп базы данных — с первых же строк понятно, что это база от вики-движка MediaWiki. В качестве движка баз данных MediaWiki поддерживает MySQL/MariaDB, PostgreSQL и SQLite. Поискав служебные слова, характерные для этих движков баз данных, найдём таблицу `sqlite_master` — значит, это дамп SQLite.

Попробуем воссоздать базу: `zcat db-dump.sql.gz | sqlite3 db-dumped.sqlite3`. В задании сказано, что самое важное — это тексты статей. Действительно, при просмотре дампа мы видим много пространных текстов про сыры — все они, согласно запросам, попадают в таблицу `text`. Попробуем обратиться к ней — и…

```
$ sqlite3 db-dumped.sqlite3
SQLite version 3.29.0 2019-07-10 17:32:03
Enter ".help" for usage hints.
sqlite> select * from text;
1|old_text|utf-8
2|old_text|utf-8
3|old_text|utf-8
...
```

А текстов-то нет. Но в дампе они есть, причём вместо текстов — подозрительно одинаковая строка `old_text`. Ищем её в дампе — и находим странную строку:

```sql
UPDATE text SET old_text=REPLACE('old_text', '---', '<hr>');
```

> Британский ютубер Том Скотт почти таким же запросом однажды [похоронил тысячи человекочасов чужого труда](https://www.youtube.com/watch?v=X6NJkWbM1xk).

Убираем этот `UPDATE` и пробуем импортировать базу заново. Ищем флаг в восстановленной таблице `text` запросом:

```sql
sqlite> SELECT * FROM text WHERE old_text LIKE '%ugra_%';
...
Сент-Мор-де-Турен производят в исторической провинции [[Турень]], расположенной в департаменте [[Эндр и Луара]]. Сыр получил своё название от небольшого городка [[Сент-Мор-де-Турен (коммуна)|Сент-Мор-де-Турен]]. Согласно легенде, французов его научили делать пленные [[сарацины]] в VIII—IX веках.ugra_mind_your_updates_fce7836d470e В [[1990 год]]у сыр получил сертификат [[Контроль подлинности происхождения|AOC]].
...
```

Вот и ответ.

Флаг: **ugra_mind_your_updates_fce7836d470e**
